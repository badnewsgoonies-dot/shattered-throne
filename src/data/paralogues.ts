import {
  ChapterDefinition, Weather, VictoryCondition, DefeatCondition,
  UnitClassName, AIBehavior, EnemyPlacement, Position
} from '../shared/types';

function enemy(charId: string, cls: UnitClassName, level: number, pos: Position, equip: string[], ai: AIBehavior, isBoss: boolean, drop?: string): EnemyPlacement {
  return { characterId: charId, className: cls, level, position: pos, equipment: equip, aiBehavior: ai, isBoss, dropItemId: drop };
}

export const paralogues: ChapterDefinition[] = [
  {
    id: 'par-arena', number: 101, title: 'The Arena Champion',
    description: 'A mysterious arena offers a chance to recruit a powerful fighter. Unlocked after completing Chapter 3.',
    mapId: 'map-arena',
    deploymentSlots: [{ x: 1, y: 5 }, { x: 2, y: 5 }, { x: 3, y: 5 }, { x: 1, y: 6 }, { x: 2, y: 6 }, { x: 3, y: 6 }],
    maxDeployments: 4,
    enemies: [
      enemy('enemy-soldier', UnitClassName.Warrior, 5, { x: 3, y: 1 }, ['steel-sword'], AIBehavior.Aggressive, false),
      enemy('enemy-soldier', UnitClassName.Warrior, 5, { x: 4, y: 1 }, ['steel-axe'], AIBehavior.Aggressive, false),
      enemy('enemy-knight', UnitClassName.Knight, 5, { x: 5, y: 2 }, ['steel-lance'], AIBehavior.Aggressive, false),
      enemy('boss-champion', UnitClassName.Berserker, 8, { x: 4, y: 1 }, ['silver-axe'], AIBehavior.Boss, true, 'brave-axe'),
    ],
    allies: [],
    victoryConditions: [{ type: VictoryCondition.BossKill, targetUnitId: 'boss-champion' }],
    defeatConditions: [{ type: DefeatCondition.AllUnitsDie }],
    reinforcements: [],
    treasures: [],
    narrative: [
      { trigger: 'preBattle', dialogue: [
        { speaker: 'Alaric', text: 'An arena? Perhaps we can find allies here.', emotion: 'neutral' },
      ]},
      { trigger: 'postBattle', dialogue: [
        { speaker: 'Alaric', text: 'Well fought! Will you join our cause?', emotion: 'happy' },
      ]},
    ],
    weather: Weather.Clear,
    rewards: { goldReward: 1500, expBonus: 200, itemRewards: ['brave-axe'], unlockedChapters: [] },
    nextChapterId: null,
  },
  {
    id: 'par-hidden-village', number: 102, title: 'Hidden Village',
    description: 'A hidden village in the forest harbors a gifted mage. Kael must be alive after Chapter 6.',
    mapId: 'map-hidden-village',
    deploymentSlots: [{ x: 6, y: 8 }, { x: 7, y: 8 }, { x: 8, y: 8 }, { x: 6, y: 9 }, { x: 7, y: 9 }, { x: 8, y: 9 }],
    maxDeployments: 5,
    enemies: [
      enemy('enemy-soldier', UnitClassName.Warrior, 7, { x: 3, y: 2 }, ['steel-axe'], AIBehavior.Aggressive, false),
      enemy('enemy-mage', UnitClassName.Mage, 7, { x: 5, y: 3 }, ['elwind'], AIBehavior.Aggressive, false),
      enemy('enemy-thief', UnitClassName.Thief, 7, { x: 7, y: 1 }, ['steel-sword'], AIBehavior.Flanker, false),
      enemy('enemy-archer', UnitClassName.Archer, 7, { x: 4, y: 0 }, ['steel-bow'], AIBehavior.Defensive, false),
      enemy('boss-bandit-chief', UnitClassName.Warrior, 9, { x: 3, y: 0 }, ['silver-axe'], AIBehavior.Boss, true, 'spirit-dust'),
    ],
    allies: [],
    victoryConditions: [{ type: VictoryCondition.Rout }],
    defeatConditions: [{ type: DefeatCondition.LordDies, protectedUnitId: 'alaric' }],
    reinforcements: [],
    treasures: [{ position: { x: 4, y: 3 }, itemId: 'elixir', requiresKey: false }],
    narrative: [
      { trigger: 'preBattle', dialogue: [
        { speaker: 'Kael', text: 'I know this place. There is a village hidden deeper in.', emotion: 'neutral' },
        { speaker: 'Alaric', text: 'Then let us clear these bandits and find it.', emotion: 'neutral' },
      ]},
    ],
    weather: Weather.Clear,
    rewards: { goldReward: 1200, expBonus: 150, itemRewards: ['spirit-dust'], unlockedChapters: [] },
    nextChapterId: null,
  },
  {
    id: 'par-treasure-hunt', number: 103, title: 'The Lost Treasury',
    description: 'Rumors of an ancient treasury draw the army to a hidden cavern.',
    mapId: 'map-ch14',
    deploymentSlots: [{ x: 4, y: 8 }, { x: 5, y: 8 }, { x: 4, y: 9 }, { x: 5, y: 9 }],
    maxDeployments: 4,
    enemies: [
      enemy('enemy-thief', UnitClassName.Thief, 8, { x: 3, y: 3 }, ['steel-sword'], AIBehavior.Flanker, false),
      enemy('enemy-thief', UnitClassName.Thief, 8, { x: 6, y: 3 }, ['steel-sword'], AIBehavior.Flanker, false),
      enemy('enemy-archer', UnitClassName.Archer, 8, { x: 5, y: 1 }, ['steel-bow'], AIBehavior.Defensive, false),
      enemy('boss-guardian', UnitClassName.General, 10, { x: 4, y: 0 }, ['silver-lance'], AIBehavior.Boss, true, 'goddess-icon'),
    ],
    allies: [],
    victoryConditions: [{ type: VictoryCondition.Rout }],
    defeatConditions: [{ type: DefeatCondition.AllUnitsDie }],
    reinforcements: [],
    treasures: [
      { position: { x: 2, y: 2 }, itemId: 'silver-sword', requiresKey: true },
      { position: { x: 7, y: 2 }, itemId: 'silver-bow', requiresKey: true },
    ],
    narrative: [
      { trigger: 'preBattle', dialogue: [
        { speaker: 'Kael', text: 'Ancient treasure! My specialty.', emotion: 'happy' },
      ]},
    ],
    weather: Weather.Clear,
    rewards: { goldReward: 2000, expBonus: 200, itemRewards: ['goddess-icon'], unlockedChapters: [] },
    nextChapterId: null,
  },
  {
    id: 'par-dark-ritual', number: 104, title: 'The Dark Ritual',
    description: 'A dark mage performs a forbidden ritual. Stop it before it is too late.',
    mapId: 'map-ch8',
    deploymentSlots: [{ x: 3, y: 8 }, { x: 4, y: 8 }, { x: 5, y: 8 }, { x: 6, y: 8 }, { x: 4, y: 9 }, { x: 5, y: 9 }],
    maxDeployments: 5,
    enemies: [
      enemy('enemy-mage', UnitClassName.Mage, 9, { x: 3, y: 2 }, ['flux'], AIBehavior.Aggressive, false),
      enemy('enemy-mage', UnitClassName.Mage, 9, { x: 6, y: 2 }, ['nosferatu'], AIBehavior.Aggressive, false),
      enemy('enemy-soldier', UnitClassName.Warrior, 9, { x: 4, y: 4 }, ['steel-axe'], AIBehavior.Aggressive, false),
      enemy('enemy-soldier', UnitClassName.Warrior, 9, { x: 5, y: 4 }, ['steel-sword'], AIBehavior.Aggressive, false),
      enemy('boss-dark-mage', UnitClassName.Sage, 12, { x: 4, y: 0 }, ['nosferatu', 'luna-tome'], AIBehavior.Boss, true, 'talisman'),
    ],
    allies: [],
    victoryConditions: [{ type: VictoryCondition.BossKill, targetUnitId: 'boss-dark-mage' }],
    defeatConditions: [{ type: DefeatCondition.LordDies, protectedUnitId: 'alaric' }, { type: DefeatCondition.TimerExpires, turnLimit: 12 }],
    reinforcements: [
      { condition: { type: 'turn', turn: 3 }, enemies: [
        enemy('enemy-mage', UnitClassName.Mage, 9, { x: 0, y: 0 }, ['flux'], AIBehavior.Aggressive, false),
      ]},
    ],
    treasures: [],
    narrative: [
      { trigger: 'preBattle', dialogue: [
        { speaker: 'Theron', text: 'That ritual... it must be stopped before the dark forces are unleashed!', emotion: 'angry' },
      ]},
    ],
    weather: Weather.Fog,
    rewards: { goldReward: 1500, expBonus: 180, itemRewards: ['talisman'], unlockedChapters: [] },
    nextChapterId: null,
  },
  {
    id: 'par-supply-raid', number: 105, title: 'Supply Raid',
    description: 'Raid an imperial supply convoy to bolster the army.',
    mapId: 'map-ch6',
    deploymentSlots: [{ x: 0, y: 10 }, { x: 1, y: 10 }, { x: 2, y: 10 }, { x: 0, y: 11 }, { x: 1, y: 11 }, { x: 2, y: 11 }],
    maxDeployments: 5,
    enemies: [
      enemy('enemy-soldier', UnitClassName.Warrior, 8, { x: 6, y: 3 }, ['steel-sword'], AIBehavior.Aggressive, false),
      enemy('enemy-knight', UnitClassName.Knight, 8, { x: 8, y: 2 }, ['steel-lance'], AIBehavior.Flanker, false),
      enemy('enemy-archer', UnitClassName.Archer, 8, { x: 10, y: 4 }, ['steel-bow'], AIBehavior.Defensive, false),
      enemy('enemy-soldier', UnitClassName.Warrior, 9, { x: 9, y: 1 }, ['steel-axe'], AIBehavior.Aggressive, false, 'concoction'),
      enemy('boss-convoy', UnitClassName.Knight, 10, { x: 11, y: 0 }, ['silver-lance'], AIBehavior.Defensive, true, 'dracoshield'),
    ],
    allies: [],
    victoryConditions: [{ type: VictoryCondition.Rout }],
    defeatConditions: [{ type: DefeatCondition.LordDies, protectedUnitId: 'alaric' }],
    reinforcements: [],
    treasures: [],
    narrative: [
      { trigger: 'preBattle', dialogue: [
        { speaker: 'Kael', text: 'An imperial supply convoy. Easy pickings.', emotion: 'happy' },
      ]},
    ],
    weather: Weather.Clear,
    rewards: { goldReward: 2500, expBonus: 150, itemRewards: ['dracoshield', 'concoction', 'concoction'], unlockedChapters: [] },
    nextChapterId: null,
  },
  {
    id: 'par-rescue-mission', number: 106, title: 'Rescue the Prisoners',
    description: 'Imperial prisoners of war are held in a fortress. Free them before time runs out.',
    mapId: 'map-ch10',
    deploymentSlots: [{ x: 4, y: 10 }, { x: 5, y: 10 }, { x: 6, y: 10 }, { x: 7, y: 10 }, { x: 5, y: 11 }, { x: 6, y: 11 }],
    maxDeployments: 6,
    enemies: [
      enemy('enemy-soldier', UnitClassName.Warrior, 10, { x: 3, y: 5 }, ['steel-sword'], AIBehavior.Aggressive, false),
      enemy('enemy-soldier', UnitClassName.Warrior, 10, { x: 8, y: 5 }, ['steel-axe'], AIBehavior.Aggressive, false),
      enemy('enemy-knight', UnitClassName.Knight, 10, { x: 5, y: 3 }, ['steel-lance'], AIBehavior.Defensive, false),
      enemy('enemy-mage', UnitClassName.Mage, 10, { x: 6, y: 3 }, ['elthunder'], AIBehavior.Aggressive, false),
      enemy('boss-jailer', UnitClassName.General, 13, { x: 5, y: 1 }, ['silver-lance', 'silver-axe'], AIBehavior.Boss, true, 'master-seal'),
    ],
    allies: [
      enemy('ally-prisoner', UnitClassName.Warrior, 8, { x: 4, y: 3 }, ['iron-sword'], AIBehavior.Defensive, false),
    ],
    victoryConditions: [{ type: VictoryCondition.BossKill, targetUnitId: 'boss-jailer' }],
    defeatConditions: [{ type: DefeatCondition.LordDies, protectedUnitId: 'alaric' }, { type: DefeatCondition.TimerExpires, turnLimit: 15 }],
    reinforcements: [],
    treasures: [],
    narrative: [
      { trigger: 'preBattle', dialogue: [
        { speaker: 'Alaric', text: 'Our people are imprisoned here. We must free them!', emotion: 'angry' },
      ]},
    ],
    weather: Weather.Clear,
    rewards: { goldReward: 1800, expBonus: 200, itemRewards: ['master-seal'], unlockedChapters: [] },
    nextChapterId: null,
  },
  {
    id: 'par-dragon-ruins', number: 107, title: 'Dragon Ruins',
    description: 'Ancient dragon ruins hold powerful weapons, but the guardians remain.',
    mapId: 'map-ch16',
    deploymentSlots: [{ x: 4, y: 10 }, { x: 5, y: 10 }, { x: 6, y: 10 }, { x: 7, y: 10 }, { x: 5, y: 11 }, { x: 6, y: 11 }],
    maxDeployments: 6,
    enemies: [
      enemy('enemy-soldier', UnitClassName.Berserker, 14, { x: 3, y: 3 }, ['silver-axe'], AIBehavior.Aggressive, false),
      enemy('enemy-soldier', UnitClassName.Berserker, 14, { x: 8, y: 3 }, ['silver-axe'], AIBehavior.Aggressive, false),
      enemy('enemy-mage', UnitClassName.Sage, 14, { x: 5, y: 1 }, ['arcfire'], AIBehavior.Aggressive, false),
      enemy('boss-dragon-guard', UnitClassName.General, 16, { x: 6, y: 0 }, ['silver-lance', 'silver-axe'], AIBehavior.Boss, true, 'boots'),
    ],
    allies: [],
    victoryConditions: [{ type: VictoryCondition.Rout }],
    defeatConditions: [{ type: DefeatCondition.AllUnitsDie }],
    reinforcements: [],
    treasures: [
      { position: { x: 2, y: 0 }, itemId: 'brave-sword', requiresKey: true },
    ],
    narrative: [
      { trigger: 'preBattle', dialogue: [
        { speaker: 'Theron', text: 'These ruins predate the empire itself. Be careful.', emotion: 'neutral' },
      ]},
    ],
    weather: Weather.Clear,
    rewards: { goldReward: 3000, expBonus: 250, itemRewards: ['boots'], unlockedChapters: [] },
    nextChapterId: null,
  },
  {
    id: 'par-holy-shrine', number: 108, title: 'The Holy Shrine',
    description: 'Elena seeks a sacred shrine to unlock her full healing potential.',
    mapId: 'map-ch18',
    deploymentSlots: [{ x: 4, y: 4 }, { x: 5, y: 4 }, { x: 4, y: 5 }, { x: 5, y: 5 }, { x: 3, y: 4 }, { x: 6, y: 5 }],
    maxDeployments: 5,
    enemies: [
      enemy('enemy-mage', UnitClassName.Mage, 10, { x: 4, y: 1 }, ['lightning'], AIBehavior.Aggressive, false),
      enemy('enemy-mage', UnitClassName.Mage, 10, { x: 5, y: 1 }, ['shine'], AIBehavior.Aggressive, false),
      enemy('enemy-cleric', UnitClassName.Cleric, 10, { x: 4, y: 0 }, ['physic-staff'], AIBehavior.Support, false),
      enemy('boss-guardian-spirit', UnitClassName.Bishop, 13, { x: 5, y: 0 }, ['aura', 'physic-staff'], AIBehavior.Boss, true, 'recover-staff'),
    ],
    allies: [],
    victoryConditions: [{ type: VictoryCondition.BossKill, targetUnitId: 'boss-guardian-spirit' }],
    defeatConditions: [{ type: DefeatCondition.ProtectedUnitDies, protectedUnitId: 'elena' }],
    reinforcements: [],
    treasures: [],
    narrative: [
      { trigger: 'preBattle', dialogue: [
        { speaker: 'Elena', text: 'The sacred shrine... I can feel its power calling to me.', emotion: 'neutral' },
      ]},
    ],
    weather: Weather.Clear,
    rewards: { goldReward: 1500, expBonus: 200, itemRewards: ['recover-staff'], unlockedChapters: [] },
    nextChapterId: null,
  },
  {
    id: 'par-pirate-cove', number: 109, title: 'The Pirate Cove',
    description: 'Pirates have been raiding coastal villages. Put an end to their terror.',
    mapId: 'map-ch9',
    deploymentSlots: [{ x: 10, y: 12 }, { x: 11, y: 12 }, { x: 12, y: 12 }, { x: 10, y: 13 }, { x: 11, y: 13 }, { x: 12, y: 13 }],
    maxDeployments: 6,
    enemies: [
      enemy('enemy-soldier', UnitClassName.Warrior, 9, { x: 4, y: 5 }, ['steel-axe'], AIBehavior.Aggressive, false),
      enemy('enemy-soldier', UnitClassName.Warrior, 9, { x: 6, y: 4 }, ['hand-axe'], AIBehavior.Aggressive, false),
      enemy('enemy-thief', UnitClassName.Thief, 9, { x: 3, y: 3 }, ['steel-sword'], AIBehavior.Flanker, false),
      enemy('enemy-archer', UnitClassName.Archer, 9, { x: 5, y: 2 }, ['steel-bow'], AIBehavior.Defensive, false),
      enemy('boss-pirate', UnitClassName.Berserker, 12, { x: 4, y: 0 }, ['silver-axe', 'hand-axe'], AIBehavior.Boss, true, 'energy-drop'),
    ],
    allies: [],
    victoryConditions: [{ type: VictoryCondition.Rout }],
    defeatConditions: [{ type: DefeatCondition.LordDies, protectedUnitId: 'alaric' }],
    reinforcements: [],
    treasures: [{ position: { x: 2, y: 1 }, itemId: 'silver-axe', requiresKey: true }],
    narrative: [
      { trigger: 'preBattle', dialogue: [
        { speaker: 'Marcus', text: 'Pirates! They have been terrorizing the coast.', emotion: 'angry' },
      ]},
    ],
    weather: Weather.Rain,
    rewards: { goldReward: 2000, expBonus: 180, itemRewards: ['energy-drop'], unlockedChapters: [] },
    nextChapterId: null,
  },
  {
    id: 'par-snow-fortress', number: 110, title: 'The Snow Fortress',
    description: 'A frozen fortress holds a strategic advantage. Capture it.',
    mapId: 'map-ch11',
    deploymentSlots: [{ x: 1, y: 4 }, { x: 2, y: 4 }, { x: 1, y: 5 }, { x: 2, y: 5 }, { x: 3, y: 5 }, { x: 3, y: 4 }],
    maxDeployments: 6,
    enemies: [
      enemy('enemy-soldier', UnitClassName.Warrior, 10, { x: 6, y: 2 }, ['steel-sword'], AIBehavior.Aggressive, false),
      enemy('enemy-soldier', UnitClassName.Warrior, 10, { x: 8, y: 3 }, ['steel-axe'], AIBehavior.Aggressive, false),
      enemy('enemy-knight', UnitClassName.Knight, 10, { x: 10, y: 2 }, ['steel-lance'], AIBehavior.Defensive, false),
      enemy('enemy-mage', UnitClassName.Mage, 10, { x: 7, y: 1 }, ['elwind'], AIBehavior.Aggressive, false),
      enemy('boss-frost', UnitClassName.Sage, 13, { x: 12, y: 1 }, ['arcwind', 'physic-staff'], AIBehavior.Boss, true, 'speedwing'),
    ],
    allies: [],
    victoryConditions: [{ type: VictoryCondition.BossKill, targetUnitId: 'boss-frost' }],
    defeatConditions: [{ type: DefeatCondition.LordDies, protectedUnitId: 'alaric' }],
    reinforcements: [],
    treasures: [],
    narrative: [
      { trigger: 'preBattle', dialogue: [
        { speaker: 'Alaric', text: 'The cold bites deep. Stay close and stay warm.', emotion: 'neutral' },
      ]},
    ],
    weather: Weather.Snow,
    rewards: { goldReward: 1800, expBonus: 200, itemRewards: ['speedwing'], unlockedChapters: [] },
    nextChapterId: null,
  },
];
