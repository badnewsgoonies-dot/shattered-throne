import {
  AoEPattern,
  SkillDefinition,
  SkillType,
  StatusEffectType,
  UnitClassName,
} from '../shared/types';

interface ActiveSkillSpec extends Omit<SkillDefinition, 'type'> {}

function activeSkill(spec: ActiveSkillSpec): SkillDefinition {
  return {
    ...spec,
    type: SkillType.Active,
  };
}

function passiveSkill(
  id: string,
  name: string,
  description: string,
  spCost: number,
  effectType: string,
  value: number,
  condition?: string,
  classRestriction?: UnitClassName[],
): SkillDefinition {
  return {
    id,
    name,
    description,
    type: SkillType.Passive,
    spCost,
    range: { min: 0, max: 0 },
    aoePattern: AoEPattern.Single,
    aoeSize: 0,
    passiveEffect: {
      type: effectType,
      value,
      condition,
    },
    classRestriction,
  };
}

export const SKILLS: SkillDefinition[] = [
  // Active damage skills
  activeSkill({
    id: 'power-strike',
    name: 'Power Strike',
    description: 'A heavy blow that scales with Strength.',
    spCost: 12,
    range: { min: 1, max: 1 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    damage: { base: 8, scaling: 'strength' },
  }),
  activeSkill({
    id: 'luna-strike',
    name: 'Luna Strike',
    description: 'Dark-infused strike that pierces defenses.',
    spCost: 18,
    range: { min: 1, max: 2 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    damage: { base: 12, scaling: 'magic' },
  }),
  activeSkill({
    id: 'sol',
    name: 'Sol',
    description: 'Damages a foe and heals the user.',
    spCost: 20,
    range: { min: 1, max: 1 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    damage: { base: 10, scaling: 'strength' },
    healing: { base: 8, scaling: 'magic' },
  }),
  activeSkill({
    id: 'astra',
    name: 'Astra',
    description: 'A flurry of rapid precision strikes.',
    spCost: 24,
    range: { min: 1, max: 1 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    damage: { base: 16, scaling: 'strength' },
  }),
  activeSkill({
    id: 'ignis',
    name: 'Ignis',
    description: 'Fuses magical force into a weapon blow.',
    spCost: 16,
    range: { min: 1, max: 2 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    damage: { base: 11, scaling: 'magic' },
  }),
  activeSkill({
    id: 'flame-burst',
    name: 'Flame Burst',
    description: 'Explodes fire in a circular area.',
    spCost: 22,
    range: { min: 1, max: 3 },
    aoePattern: AoEPattern.Circle,
    aoeSize: 2,
    damage: { base: 13, scaling: 'magic' },
    classRestriction: [UnitClassName.Mage, UnitClassName.Sage, UnitClassName.DarkKnight],
  }),
  activeSkill({
    id: 'wind-blade',
    name: 'Wind Blade',
    description: 'Slices enemies in a straight line.',
    spCost: 18,
    range: { min: 1, max: 3 },
    aoePattern: AoEPattern.Line,
    aoeSize: 3,
    damage: { base: 10, scaling: 'magic' },
  }),
  activeSkill({
    id: 'thunder-strike',
    name: 'Thunder Strike',
    description: 'Calls down lightning in a cross-shaped burst.',
    spCost: 20,
    range: { min: 1, max: 3 },
    aoePattern: AoEPattern.Cross,
    aoeSize: 2,
    damage: { base: 12, scaling: 'magic' },
  }),
  activeSkill({
    id: 'fireball',
    name: 'Fireball',
    description: 'A focused flame projectile.',
    spCost: 10,
    range: { min: 1, max: 2 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    damage: { base: 7, scaling: 'magic' },
  }),
  activeSkill({
    id: 'precision-shot',
    name: 'Precision Shot',
    description: 'A highly accurate bow technique.',
    spCost: 10,
    range: { min: 2, max: 3 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    damage: { base: 7, scaling: 'strength' },
    classRestriction: [UnitClassName.Archer, UnitClassName.Sniper, UnitClassName.Ranger],
  }),
  activeSkill({
    id: 'deadeye',
    name: 'Deadeye',
    description: 'An armor-piercing long-range shot.',
    spCost: 20,
    range: { min: 2, max: 4 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    damage: { base: 14, scaling: 'strength' },
    classRestriction: [UnitClassName.Sniper, UnitClassName.Ranger],
  }),
  activeSkill({
    id: 'shadowstep',
    name: 'Shadowstep',
    description: 'Strike from the shadows and reposition.',
    spCost: 15,
    range: { min: 1, max: 1 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    damage: { base: 9, scaling: 'strength' },
    classRestriction: [UnitClassName.Assassin, UnitClassName.Trickster],
  }),
  activeSkill({
    id: 'dark-aura',
    name: 'Dark Aura',
    description: 'A pulse of dark energy that weakens foes.',
    spCost: 18,
    range: { min: 1, max: 2 },
    aoePattern: AoEPattern.Circle,
    aoeSize: 1,
    damage: { base: 9, scaling: 'magic' },
    debuff: { stats: { defense: -3, resistance: -3 }, duration: 2 },
  }),
  activeSkill({
    id: 'moonpiercer',
    name: 'Moonpiercer',
    description: 'A lance art that ignores a portion of defense.',
    spCost: 16,
    range: { min: 1, max: 1 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    damage: { base: 10, scaling: 'strength' },
  }),
  activeSkill({
    id: 'dragon-fang',
    name: 'Dragon Fang',
    description: 'A brutal overhead strike.',
    spCost: 20,
    range: { min: 1, max: 1 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    damage: { base: 15, scaling: 'strength' },
  }),
  activeSkill({
    id: 'hunter-volley',
    name: 'Hunter Volley',
    description: 'Rapid two-arrow burst at close range.',
    spCost: 16,
    range: { min: 2, max: 2 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    damage: { base: 11, scaling: 'strength' },
  }),
  activeSkill({
    id: 'comet-lance',
    name: 'Comet Lance',
    description: 'Charging thrust that crashes like a comet.',
    spCost: 17,
    range: { min: 1, max: 2 },
    aoePattern: AoEPattern.Line,
    aoeSize: 2,
    damage: { base: 12, scaling: 'strength' },
  }),
  activeSkill({
    id: 'axe-rend',
    name: 'Axe Rend',
    description: 'Crippling axe blow against armored targets.',
    spCost: 14,
    range: { min: 1, max: 1 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    damage: { base: 11, scaling: 'strength' },
    debuff: { stats: { defense: -4 }, duration: 2 },
  }),
  activeSkill({
    id: 'holy-smite',
    name: 'Holy Smite',
    description: 'Light magic strike favored by bishops.',
    spCost: 19,
    range: { min: 1, max: 2 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    damage: { base: 13, scaling: 'magic' },
  }),

  // Active heal and support skills
  activeSkill({
    id: 'heal',
    name: 'Heal',
    description: 'Restore HP to one ally.',
    spCost: 8,
    range: { min: 1, max: 1 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    healing: { base: 12, scaling: 'magic' },
    classRestriction: [UnitClassName.Cleric, UnitClassName.Bishop, UnitClassName.Valkyrie],
  }),
  activeSkill({
    id: 'greater-heal',
    name: 'Greater Heal',
    description: 'Restore a large amount of HP.',
    spCost: 15,
    range: { min: 1, max: 2 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    healing: { base: 22, scaling: 'magic' },
  }),
  activeSkill({
    id: 'rally-strength',
    name: 'Rally Strength',
    description: 'Boosts Strength of nearby allies.',
    spCost: 10,
    range: { min: 0, max: 1 },
    aoePattern: AoEPattern.Circle,
    aoeSize: 2,
    buff: { stats: { strength: 4 }, duration: 2 },
  }),
  activeSkill({
    id: 'rally-speed',
    name: 'Rally Speed',
    description: 'Boosts Speed of nearby allies.',
    spCost: 10,
    range: { min: 0, max: 1 },
    aoePattern: AoEPattern.Circle,
    aoeSize: 2,
    buff: { stats: { speed: 4 }, duration: 2 },
  }),
  activeSkill({
    id: 'rally-magic',
    name: 'Rally Magic',
    description: 'Boosts Magic of nearby allies.',
    spCost: 10,
    range: { min: 0, max: 1 },
    aoePattern: AoEPattern.Circle,
    aoeSize: 2,
    buff: { stats: { magic: 4 }, duration: 2 },
  }),
  activeSkill({
    id: 'rally-defense',
    name: 'Rally Defense',
    description: 'Boosts Defense of nearby allies.',
    spCost: 10,
    range: { min: 0, max: 1 },
    aoePattern: AoEPattern.Circle,
    aoeSize: 2,
    buff: { stats: { defense: 4 }, duration: 2 },
  }),
  activeSkill({
    id: 'dance',
    name: 'Dance',
    description: 'Grants one ally another action.',
    spCost: 18,
    range: { min: 1, max: 1 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    buff: { stats: { speed: 2 }, duration: 1 },
    classRestriction: [UnitClassName.Dancer],
  }),
  activeSkill({
    id: 'restore',
    name: 'Restore',
    description: 'Removes one status effect from an ally.',
    spCost: 12,
    range: { min: 1, max: 2 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    classRestriction: [UnitClassName.Cleric, UnitClassName.Bishop, UnitClassName.Valkyrie],
  }),
  activeSkill({
    id: 'barrier',
    name: 'Barrier',
    description: 'Raises ally resistance temporarily.',
    spCost: 10,
    range: { min: 1, max: 2 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    buff: { stats: { resistance: 6 }, duration: 2 },
  }),
  activeSkill({
    id: 'rescue',
    name: 'Rescue',
    description: 'Pulls an ally to an adjacent tile.',
    spCost: 14,
    range: { min: 1, max: 3 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    classRestriction: [UnitClassName.Bishop, UnitClassName.Valkyrie],
  }),
  activeSkill({
    id: 'shelter',
    name: 'Shelter',
    description: 'Grants temporary defense to a nearby ally.',
    spCost: 9,
    range: { min: 1, max: 1 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    buff: { stats: { defense: 3 }, duration: 1 },
  }),
  activeSkill({
    id: 'fortify-chant',
    name: 'Fortify Chant',
    description: 'AoE healing hymn for nearby allies.',
    spCost: 22,
    range: { min: 0, max: 1 },
    aoePattern: AoEPattern.Circle,
    aoeSize: 2,
    healing: { base: 14, scaling: 'magic' },
  }),
  activeSkill({
    id: 'inspiration',
    name: 'Inspiration',
    description: 'Raises allied attack and accuracy.',
    spCost: 11,
    range: { min: 0, max: 1 },
    aoePattern: AoEPattern.Circle,
    aoeSize: 2,
    buff: { stats: { strength: 2, skill: 2 }, duration: 2 },
  }),
  activeSkill({
    id: 'graceful-step',
    name: 'Graceful Step',
    description: 'Gives an ally speed and luck.',
    spCost: 10,
    range: { min: 1, max: 1 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    buff: { stats: { speed: 3, luck: 3 }, duration: 2 },
  }),
  activeSkill({
    id: 'war-cry',
    name: 'War Cry',
    description: 'Rallies nearby allies for offensive push.',
    spCost: 10,
    range: { min: 0, max: 1 },
    aoePattern: AoEPattern.Circle,
    aoeSize: 2,
    buff: { stats: { strength: 3 }, duration: 2 },
  }),
  activeSkill({
    id: 'focus-chant',
    name: 'Focus Chant',
    description: 'Sharpens ally aim and magical output.',
    spCost: 11,
    range: { min: 0, max: 1 },
    aoePattern: AoEPattern.Circle,
    aoeSize: 2,
    buff: { stats: { skill: 3, magic: 2 }, duration: 2 },
  }),

  // Active debuff and status skills
  activeSkill({
    id: 'poison-strike',
    name: 'Poison Strike',
    description: 'Inflicts poison on hit.',
    spCost: 12,
    range: { min: 1, max: 1 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    damage: { base: 6, scaling: 'strength' },
    statusEffect: { type: StatusEffectType.Poison, chance: 70, duration: 3 },
  }),
  activeSkill({
    id: 'silence-skill',
    name: 'Silence',
    description: 'Prevents a caster from using spells.',
    spCost: 14,
    range: { min: 1, max: 3 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    statusEffect: { type: StatusEffectType.Silence, chance: 65, duration: 2 },
  }),
  activeSkill({
    id: 'hex',
    name: 'Hex',
    description: 'Weakens enemy offenses and defenses.',
    spCost: 13,
    range: { min: 1, max: 2 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    debuff: { stats: { strength: -3, magic: -3, defense: -2, resistance: -2 }, duration: 2 },
  }),
  activeSkill({
    id: 'enfeeble',
    name: 'Enfeeble',
    description: 'Reduces enemy durability significantly.',
    spCost: 15,
    range: { min: 1, max: 3 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    debuff: { stats: { defense: -5, resistance: -5 }, duration: 2 },
  }),
  activeSkill({
    id: 'sleep-dart',
    name: 'Sleep Dart',
    description: 'Puts target to sleep with a poisoned dart.',
    spCost: 16,
    range: { min: 2, max: 3 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    statusEffect: { type: StatusEffectType.Sleep, chance: 55, duration: 2 },
  }),
  activeSkill({
    id: 'shackle',
    name: 'Shackle',
    description: 'Pins target in place and slows movement.',
    spCost: 14,
    range: { min: 1, max: 2 },
    aoePattern: AoEPattern.Single,
    aoeSize: 1,
    debuff: { stats: { speed: -4, movement: -2 }, duration: 2 },
  }),
  activeSkill({
    id: 'fear',
    name: 'Fear',
    description: 'Breaks enemy morale and lowers power.',
    spCost: 12,
    range: { min: 1, max: 2 },
    aoePattern: AoEPattern.Cone,
    aoeSize: 2,
    debuff: { stats: { strength: -4, magic: -4 }, duration: 2 },
  }),
  activeSkill({
    id: 'smoke-screen',
    name: 'Smoke Screen',
    description: 'Obscures vision and reduces target accuracy.',
    spCost: 10,
    range: { min: 1, max: 2 },
    aoePattern: AoEPattern.Circle,
    aoeSize: 1,
    statusEffect: { type: StatusEffectType.Blind, chance: 70, duration: 2 },
  }),

  // Passive skills
  passiveSkill('vantage', 'Vantage', 'Strike first when below half HP.', 18, 'initiativeSwap', 1, 'hp<=50%'),
  passiveSkill('wrath', 'Wrath', 'Increases critical rate at low HP.', 20, 'critBonus', 25, 'hp<=50%'),
  passiveSkill('renewal', 'Renewal', 'Recover HP each turn.', 14, 'regenPercent', 10),
  passiveSkill('counter', 'Counter', 'Reflect part of melee damage taken.', 22, 'reflectPercent', 50),
  passiveSkill('miracle', 'Miracle', 'Survive lethal damage with 1 HP.', 25, 'surviveLethal', 1),
  passiveSkill('pavise', 'Pavise', 'Chance to halve physical damage.', 20, 'halvePhysicalChance', 35),
  passiveSkill('aegis', 'Aegis', 'Chance to halve magical damage.', 20, 'halveMagicalChance', 35),
  passiveSkill('desperation', 'Desperation', 'Follow-up attacks occur immediately.', 16, 'earlyFollowUp', 1),
  passiveSkill('quick-burn', 'Quick Burn', 'Boosts avoid early in battle.', 10, 'avoidBonusEarlyTurns', 20),
  passiveSkill('lifetaker', 'Lifetaker', 'Recover HP after defeating an enemy.', 24, 'healOnKill', 20),
  passiveSkill('pass', 'Pass', 'Move through enemy-occupied tiles.', 12, 'ignoreUnitCollision', 1),
  passiveSkill('locktouch', 'Locktouch', 'Open doors and chests without keys.', 10, 'canOpenLocks', 1),
  passiveSkill('steal-step', 'Steal Step', 'Improves steal and pickpocket actions.', 12, 'stealBonus', 20),
  passiveSkill('hawkeye', 'Hawkeye', 'Improves hit rate with bows.', 12, 'hitBonus', 20),
  passiveSkill('focus-magic', 'Focus Magic', 'Increases tome damage consistency.', 12, 'magicDamageBonus', 3),
  passiveSkill('lance-discipline', 'Lance Discipline', 'Improves lance accuracy and might.', 12, 'lanceMastery', 1),
  passiveSkill('arcane-mastery', 'Arcane Mastery', 'Reduces SP cost of offensive spells.', 16, 'magicSpCostReduction', 20),
  passiveSkill('mounted-archery', 'Mounted Archery', 'Removes hit penalty while mounted.', 14, 'mountedBowPenaltyReduction', 1),
  passiveSkill('lucky-seven', 'Lucky Seven', 'Large bonuses for first seven turns.', 18, 'earlyTurnAllStats', 2),
  passiveSkill('warding-blow', 'Warding Blow', 'Gain resistance when initiating combat.', 12, 'initiationResBonus', 6),
  passiveSkill('steadfast', 'Steadfast', 'Reduces status effect duration on self.', 10, 'statusDurationReduction', 1),
  passiveSkill('holy-ward', 'Holy Ward', 'Gain resistance against dark magic.', 14, 'darkResBonus', 6),
  passiveSkill('quick-draw', 'Quick Draw', 'Gain bonus damage when initiating with bows.', 12, 'initiationBowDamage', 4),
  passiveSkill('lethality', 'Lethality', 'Chance to deal massive damage.', 28, 'executeChance', 12),
  passiveSkill('canto', 'Canto', 'Move after taking an action.', 18, 'postActionMove', 1),
  passiveSkill('fortress', 'Fortress', 'Flat damage reduction while stationary.', 14, 'stationaryDamageReduction', 3),
  passiveSkill('shadow-veil', 'Shadow Veil', 'Gain avoid in forests and darkness.', 12, 'terrainAvoidBonus', 20),
  passiveSkill('battle-instinct', 'Battle Instinct', 'Gain hit and avoid when outnumbered.', 12, 'outnumberedCombatBonus', 15),
  passiveSkill('guard-breaker', 'Guard Breaker', 'Deal extra damage to armored targets.', 12, 'bonusVsArmored', 5),
  passiveSkill('resolve', 'Resolve', 'Gain defense and resistance at low HP.', 16, 'lowHpDefResBonus', 4),
];

export function getSkillById(id: string): SkillDefinition | null {
  return SKILLS.find((entry) => entry.id === id) ?? null;
}

export function getAllSkills(): SkillDefinition[] {
  return [...SKILLS];
}
